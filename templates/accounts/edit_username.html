<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Update Username - Instagram Style</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --gradient-start: #f58529;
    --gradient-end: #dd2a7b;
    --bg-light: #fafafa;
    --text-dark: #262626;
    --text-grey: #8e8e8e;
    --border-color: #dbdbdb;
    --btn-primary: #e1306c;
    --btn-success: #4CAF50;
    --shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Reset */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
html, body { height:100%; width:100%; overflow-x:hidden; background:var(--bg-light); }

/* Layout ch√≠nh */
body { display:flex; min-height:100vh; }

/* Sidebar icon */
.icon-sidebar {
    width:60px; background:linear-gradient(180deg,var(--gradient-start),var(--gradient-end));
    display:flex; flex-direction:column; align-items:center; justify-content:space-between; padding:20px 0; flex-shrink:0;
}
.logo-circle { width:45px; height:45px; border-radius:50%; background:#fff; color:var(--btn-primary);
    font-weight:bold; font-size:22px; display:flex; align-items:center; justify-content:center; margin-bottom:30px; font-family:serif; }
.nav-icons { display:flex; flex-direction:column; gap:25px; flex-grow:1; margin-top:15px; }
.nav-icon { color:#fff; font-size:22px; cursor:pointer; transition:0.3s; }
.nav-icon:hover { opacity:0.7; }
.settings-icon-bottom { background:var(--btn-primary); color:#fff; width:45px; height:45px; border-radius:50%;
    display:flex; align-items:center; justify-content:center; font-size:20px; box-shadow:var(--shadow); }

/* Sidebar menu */
.menu-sidebar {
    width:240px; background:#fff; padding:30px 20px; border-right:1px solid var(--border-color);
    display:flex; flex-direction:column; flex-shrink:0;
}
.back-link { display:flex; align-items:center; color:var(--text-dark); text-decoration:none; font-weight:600; margin-bottom:25px; font-size:16px; }
.back-link i { margin-right:8px; font-size:14px; }
.menu-list { list-style:none; flex-grow:1; margin-top:10px; }
.menu-item { margin-bottom:18px; display:flex; align-items:center; color:var(--text-grey); font-size:16px; cursor:pointer; transition:0.2s; padding:8px 12px; border-radius:6px; }
.menu-item i { margin-right:10px; width:18px; text-align:center; }
.menu-item.active { color:var(--text-dark); font-weight:600; background-color:#f8f9fa; }
.menu-item.active i { color:var(--btn-primary); }
.menu-item:hover { background-color:#f8f9fa; }

/* Main content */
.main-content {
    flex:1; background:#fff; padding:30px 40px;
    display:flex; flex-direction:column; align-items:center;
    min-width:0;
    overflow-y:auto;
    max-height:100vh;
}

/* Header */
.header-area { width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:35px; flex-wrap:wrap; }
.page-title { font-size:28px; font-weight:700; color:var(--text-dark); }
.top-right-actions { display:flex; align-items:center; gap:18px; margin-top:10px; }
.notification-bell { background:#efefef; width:38px; height:38px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#555; cursor:pointer; font-size:16px; transition:0.3s; }
.notification-bell:hover { background:#e0e0e0; transform:scale(1.05); }
.small-avatar { width:38px; height:38px; border-radius:50%; object-fit:cover; border:2px solid var(--border-color); }

/* Main avatar */
.main-avatar-container { margin-bottom:25px; }
.main-avatar { width:130px; height:130px; border-radius:50%; object-fit:cover; border:3px solid #fff; box-shadow:var(--shadow); }

/* Special form for username only */
.special-form { display:flex; flex-direction:column; width:100%; max-width:600px; margin-top:20px; }
.form-section { background:#fff; padding:30px; border-radius:10px; margin-bottom:20px; border:1px solid var(--border-color); box-shadow:var(--shadow); }
.form-section h3 { margin-bottom:15px; color:var(--text-dark); font-size:20px; font-weight:600; }
.form-section p { color:var(--text-grey); margin-bottom:20px; font-size:14px; line-height:1.5; }
.form-row { display:flex; flex-direction:column; margin-bottom:20px; }
.form-row label { font-size:15px; font-weight:500; margin-bottom:8px; color:var(--text-dark); }
.form-row input { width:100%; padding:12px 15px; border:1px solid var(--border-color); border-radius:8px; font-size:14px; transition:all 0.3s; }
.form-row input:focus { border-color:var(--btn-primary); box-shadow:0 0 0 2px rgba(225, 48, 108, 0.2); outline:none; }
.form-actions { display:flex; gap:12px; margin-top:15px; }
.btn-username { background:linear-gradient(135deg, var(--btn-success), #2E7D32); color:white; padding:12px 25px; border:none; border-radius:8px; cursor:pointer; font-weight:500; font-size:15px; transition:all 0.3s; box-shadow:var(--shadow); }
.btn-username:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(76, 175, 80, 0.3); }
.btn-cancel { background:white; color:var(--text-dark); padding:12px 25px; border:1px solid var(--border-color); border-radius:8px; cursor:pointer; font-weight:500; font-size:15px; transition:all 0.3s; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; }
.btn-cancel:hover { background:#f8f9fa; border-color:#c5c5c5; }

/* Messages */
.messages { margin-bottom:15px; padding:10px; border-radius:6px; background-color:#d4edda; color:#155724; border:1px solid #c3e6cb; }

/* Responsive */
@media (max-width:1024px) {
    .menu-sidebar { width:200px; padding:25px 15px; }
    .main-content { padding:25px; }
    .main-avatar { width:120px; height:120px; }
}
@media (max-width:768px) {
    body { flex-direction:column; }
    .icon-sidebar, .menu-sidebar { width:100%; flex-direction:row; padding:12px; justify-content:space-between; border-right:none; border-bottom:1px solid var(--border-color); }
    .main-content { padding:25px; }
    .main-avatar { width:100px; height:100px; }
    .header-area { flex-direction:column; align-items:flex-start; gap:15px; }
    .special-form { padding:0 10px; }
    .form-section { padding:20px; }
    .form-actions { flex-direction:column; }
    .btn-username, .btn-cancel { width:100%; }
}
</style>
</head>
<body>

<aside class="icon-sidebar">
    <div class="logo-circle">SD</div>
    <div class="nav-icons">
        <a href="/" class="nav-icon"><i class="fa-solid fa-house"></i></a>
        <a href="/notifications" class="nav-icon"><i class="fa-regular fa-bell"></i></a>
        <i class="fa-regular fa-calendar nav-icon"></i>
        <i class="fa-solid fa-chart-line nav-icon"></i>
        <i class="fa-regular fa-user nav-icon"></i>
    </div>
    <div class="settings-icon-bottom" onclick="location.href='/settings'">
        <i class="fa-solid fa-gear"></i>
    </div>
</aside>

<aside class="menu-sidebar">
    <a href="{% url 'profile' %}" class="back-link"><i class="fa-solid fa-chevron-left"></i> My Profile</a>
    <h2 style="margin-bottom:15px; font-size:18px;">Edit profile</h2>
    <ul class="menu-list">
        <li class="menu-item" onclick="location.href='/accounts/edit_profile'"><i class="fa-solid fa-pen"></i> Edit profile</li>
        <li class="menu-item" onclick="location.href='/notifications'"><i class="fa-regular fa-bell"></i> Notification</li>
        <li class="menu-item" onclick="location.href='{% url 'update_email' %}'"><i class="fa-solid fa-envelope"></i> Update Email</li>
        <li class="menu-item active"><i class="fa-solid fa-at"></i> Update Username</li>
        <li class="menu-item" onclick="location.href='{% url 'update_password' %}'"><i class="fa-solid fa-key"></i> Update Password</li>
        <li class="menu-item"><i class="fa-solid fa-gear"></i> Appearance</li>
        <li class="menu-item"><i class="fa-regular fa-circle-question"></i> Settings</li>
    </ul>
</aside>

<main class="main-content">
    <div class="header-area">
        <h1 class="page-title">Update Username</h1>
        <div class="top-right-actions">
            <div class="notification-bell"><i class="fa-regular fa-bell"></i></div>
            <img src="{{ profile.avatar.url }}" class="small-avatar">
        </div>
    </div>

    <div class="main-avatar-container">
        <img src="{{ profile.avatar.url }}" alt="Main Profile" class="main-avatar">
    </div>

    <!-- Username Update Form Only -->
    <div class="special-form">
        <form method="POST">
            {% csrf_token %}

            <div class="form-section">
                <h3>Change Username</h3>
                <p>
                    Enter your new username. Your profile will reload after saving.
                </p>

                {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                            <p>{{ message }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-row">
                    <label for="new_username">New Username</label>
                    <input
                        type="text"
                        id="new_username"
                        name="new_username"
                        value="{{ user.username }}"
                        placeholder="Enter your new username"
                        required
                    >
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-username">
                        <i class="fa-solid fa-check" style="margin-right:8px;"></i>
                        Change Username
                    </button>
                    <a href="{% url 'profile' %}" class="btn-cancel">
                        <i class="fa-solid fa-times" style="margin-right:8px;"></i>
                        Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>
</main>

<script>
    // Hover effect for menu items
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.addEventListener('click', () => {
            menuItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
        });
    });
    
    // Input focus effects
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('focus', () => {
            input.parentElement.classList.add('focused');
        });
        input.addEventListener('blur', () => {
            input.parentElement.classList.remove('focused');
        });
    });
    
    // Form submission handling
    document.querySelector('form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const formData = new FormData(this);
        const newUsername = formData.get('new_username');
        
        // Validate username
        if (!newUsername || newUsername.trim().length < 3) {
            alert('Username must be at least 3 characters long');
            return;
        }
        
        // Check for special characters (optional validation)
        const usernameRegex = /^[a-zA-Z0-9._]+$/;
        if (!usernameRegex.test(newUsername)) {
            alert('Username can only contain letters, numbers, periods, and underscores');
            return;
        }
        
        // Submit the form
        this.submit();
    });
</script>

</body>
</html>