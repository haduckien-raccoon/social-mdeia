{% load friend_tags %} 
{% block content %}
<div class="container" style="max-width: 935px; margin: 30px auto;">
    
    {% if pending_requests %}
    <div class="section">
        <h3>Friend Requests</h3>
        <div class="grid-friends">
            {% for req in pending_requests %}
            <div class="card">
                <img src="{{ req.from_user|get_avatar }}" alt="avatar">
                <div class="info">
                    <b><a href="/profile/{{ req.from_user.username }}">{{ req.from_user.username }}</a></b>
                    <div class="btns">
                        <form action="{% url 'friends:accept_request' req.id %}" method="POST">
                            {% csrf_token %}
                            <button class="btn-blue">Confirm</button>
                        </form>
                        <form action="{% url 'friends:reject_request' req.id %}" method="POST">
                            {% csrf_token %}
                            <button class="btn-grey">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="section">
        <h3>People You May Know</h3>
        <div class="grid-friends">
            {% for user in suggestions %}
            <div class="card">
                <img src="{{ user|get_avatar }}" alt="avatar">
                <div class="info">
                    <b><a href="/accounts/profile/{{ user.id }}">{{ user.username }}</a></b>
                    {% if user.mutual_count > 0 %}
                        <small style="color:#8e8e8e">{{ user.mutual_count }} mutual friends</small>
                    {% else %}
                        <small style="color:#8e8e8e">Suggested for you</small>
                    {% endif %}
                    
                    <form action="{% url 'friends:send_request' user.id %}" method="POST" style="margin-top:5px;">
                        {% csrf_token %}
                        <button class="btn-blue" style="width:100%">Add Friend</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="section">
        <h3>All Friends ({{ friends|length }})</h3>
        <div class="grid-friends">
            {% for friend in friends %}
            <div class="card">
                <img src="{{ friend|get_avatar }}">
                <div class="info">
                    <b>{{ friend.username }}</b>
                    <a href="/accounts/profile/{{ friend.id }}" class="btn-grey" style="text-align:center; display:block; margin-top:5px;">View Profile</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .grid-friends { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top: 15px; }
    .card { border: 1px solid #dbdbdb; border-radius: 8px; overflow: hidden; background: #fff; }
    .card img { width: 100%; height: 180px; object-fit: cover; }
    .card .info { padding: 10px; display: flex; flex-direction: column; gap: 5px; }
    .btn-blue { background: #0095f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-weight: 600; cursor: pointer; }
    .btn-grey { background: #efefef; color: black; border: none; padding: 5px 10px; border-radius: 4px; font-weight: 600; cursor: pointer; }
</style>
{% endblock %}