<style>
    /* CSS Ri√™ng cho Post Card */
    .post-header { padding: 15px; }
    .post-content { padding: 5px 15px 15px 15px; font-size: 15px; line-height: 1.5; color: #1c1e21; }
    
    /* Reaction Bar Style */
    .action-btn {
        color: #65676b;
        font-weight: 600;
        font-size: 14px;
        padding: 8px 0;
        border-radius: 6px;
        transition: 0.2s;
    }
    .action-btn:hover { background-color: #f2f2f2; color: #4b4c4f; }
    .action-btn.active { color: var(--primary-color); }
    
    /* Popup Reaction n·ªïi l√™n ƒë·∫πp h∆°n */
    .reaction-container { position: relative; }
    .reaction-popup {
        position: absolute; bottom: 120%; left: 0;
        background: white; border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: flex; gap: 8px;
        opacity: 0; visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 99;
    }
    .reaction-container:hover .reaction-popup {
        opacity: 1; visibility: visible; transform: translateY(0);
    }
    .reaction-icon-anim {
        font-size: 24px; transition: 0.2s; cursor: pointer;
    }
    .reaction-icon-anim:hover { transform: scale(1.4) translateY(-3px); }

    /* Grid ·∫£nh ƒë∆°n gi·∫£n */
    .post-images-grid {
        display: grid; gap: 2px;
        grid-template-columns: repeat(auto-fit, minmax(49%, 1fr));
        overflow: hidden;
        border-top: 1px solid #eee; border-bottom: 1px solid #eee;
    }
    .post-img-item {
        width: 100%; height: 300px; object-fit: cover;
        cursor: pointer; transition: 0.2s;
    }
    .post-img-item:hover { opacity: 0.95; }
</style>

<div class="card-modern" id="post-{{ post.id }}">
    <div class="post-header d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center">
            <a href="#">
                <img src="https://ui-avatars.com/api/?name={{ post.author.username }}&background=random" 
                     class="avatar-circle me-2" width="40" height="40">
            </a>
            <div>
                <h6 class="mb-0 fw-bold"><a href="#" class="text-dark">{{ post.author.username }}</a></h6>
                <div class="text-muted small">
                    {{ post.created_at|date:"d/m H:i" }} ¬∑ 
                    {% if post.privacy == 'public' %}<i class="fas fa-earth-americas" title="C√¥ng khai"></i>
                    {% elif post.privacy == 'friends' %}<i class="fas fa-user-friends" title="B·∫°n b√®"></i>
                    {% else %}<i class="fas fa-lock" title="Ch·ªâ m√¨nh t√¥i"></i>{% endif %}
                </div>
            </div>
        </div>
        
        {% if request.user == post.author %}
        <div class="dropdown">
            <button class="btn btn-link text-muted p-0" data-bs-toggle="dropdown"><i class="fas fa-ellipsis"></i></button>
            <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                <li><a class="dropdown-item" href="/posts/{{ post.id }}/edit/"><i class="fas fa-pen me-2"></i>S·ª≠a b√†i</a></li>
                <li><a class="dropdown-item text-danger" href="/posts/{{ post.id }}/delete/" onclick="return confirm('X√≥a b√†i n√†y?')"><i class="fas fa-trash me-2"></i>X√≥a b√†i</a></li>
            </ul>
        </div>
        {% endif %}
    </div>

    <div class="post-content">
        {{ post.content|linebreaksbr }}
    </div>

    {% if post.images.all %}
    <div class="post-images-grid">
        {% for img in post.images.all|slice:":4" %}
        <img src="{{ img.image.url }}" class="post-img-item">
        {% endfor %}
    </div>
    {% endif %}

    {% if post.files.all %}
    <div class="px-3 pb-3">
        {% for f in post.files.all %}
        <div class="p-2 mt-2 bg-light border rounded d-flex align-items-center">
            <i class="fas fa-file-alt text-primary fs-4 me-3"></i>
            <div>
                <a href="{{ f.file.url }}" target="_blank" class="fw-bold text-dark d-block">{{ f.filename }}</a>
                <small class="text-muted">T·ªáp ƒë√≠nh k√®m</small>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="px-3 py-2 d-flex justify-content-between align-items-center text-muted small border-bottom">
        <div class="d-flex align-items-center">
            {% if post.reactions.count > 0 %}
            <span class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-1" style="width:18px; height:18px;">
                <i class="fas fa-thumbs-up" style="font-size:10px;"></i>
            </span>
            <span id="reaction-count-{{ post.id }}">{{ post.reactions.count }}</span>
            {% endif %}
        </div>
        <div>
            <a href="{% url 'posts:post_detail' post.id %}" class="text-muted">{{ post.comments.count }} b√¨nh lu·∫≠n</a>
        </div>
    </div>

    <div class="d-flex px-2 py-1">
        <div class="col-4 px-1 reaction-container">
            <div class="reaction-popup">
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'like')">üëç</span>
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'love')">‚ù§Ô∏è</span>
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'haha')">üòÜ</span>
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'wow')">üòÆ</span>
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'sad')">üò¢</span>
                <span class="reaction-icon-anim" onclick="toggleReaction({{ post.id }}, 'angry')">üò°</span>
            </div>

            <button id="btn-post-like-{{ post.id }}" 
                class="btn w-100 action-btn {% if user_post_reaction %}active{% endif %}"
                onclick="toggleReaction({{ post.id }}, 'like')">
                <i class="{% if user_post_reaction.reaction_type == 'like' %}fas fa-thumbs-up{% else %}far fa-thumbs-up{% endif %} me-2"></i>
                <span id="text-post-like-{{ post.id }}">{% if user_post_reaction %}{{ user_post_reaction.reaction_type|title }}{% else %}Th√≠ch{% endif %}</span>
            </button>
        </div>
        
        <div class="col-4 px-1">
            <a href="{% url 'posts:post_detail' post.id %}" class="btn w-100 action-btn">
                <i class="far fa-comment-alt me-2"></i>B√¨nh lu·∫≠n
            </a>
        </div>
        
        <div class="col-4 px-1">
            <button class="btn w-100 action-btn" data-bs-toggle="modal" data-bs-target="#shareModal-{{ post.id }}">
                <i class="fas fa-share me-2"></i>Chia s·∫ª
            </button>
        </div>
    </div>
</div>

<div class="modal fade" id="shareModal-{{ post.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form action="/posts/{{ post.id }}/share/" method="POST" class="w-100">
            {% csrf_token %}
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Chia s·∫ª b√†i vi·∫øt</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea name="caption" class="form-control border-0 bg-light rounded-3 mb-3 p-3" rows="3" placeholder="N√≥i g√¨ ƒë√≥ v·ªÅ b√†i vi·∫øt n√†y..."></textarea>
                    <select name="privacy" class="form-select border-0 bg-light rounded-3">
                        <option value="public">üåç C√¥ng khai</option>
                        <option value="friends">üë• B·∫°n b√®</option>
                        <option value="only_me">üîí Ch·ªâ m√¨nh t√¥i</option>
                    </select>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="submit" class="btn btn-primary w-100 rounded-3 fw-bold">Chia s·∫ª ngay</button>
                </div>
            </div>
        </form>
    </div>
</div>